<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title> | vSphere Docker Volume Service</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> vSphere Docker Volume Service</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="http:www.vmware.comin.html">VMWare Home</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Social Media<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://www.youtube.com/user/vmwaretv" target="_blank">VMWare on Youtube</a></li>
                        
                        
                        
                        <li><a href="https://communities.vmware.com/community/vmtn/foreign-language-forums" target="_blank">Communities</a></li>
                        
                        
                        
                        <li><a href="https://twitter.com/VMwareIN" target="_blank">Twitter</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:tomjohnson1492@gmail.com?subject=Jekyll documentation theme feedback&body=I have some feedback about the  page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          












<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Menu </li>
    
    
    
    <li>
        <a href="#">Get Started</a>
        <ul>
            
            
            
            <li><a href="index.html">Welcome to Docker</a></li>
            
            
            
            
            
            
            <li><a href="tenancy.html">Tenancy</a></li>
            
            
            
            
            
            
            <li><a href="admin-cli.html">Admin CLI</a></li>
            
            
            
            
            
            
            <li><a href="install.html">Installation</a></li>
            
            
            
            
            
            
            <li><a href="vcenter.html">vCenter</a></li>
            
            
            
            
            
            
            <li><a href="vsphere-overview.html">vSphere Overview</a></li>
            
            
            
            
            
            
            <li><a href="vsanpolicy.html">vSAN Policy</a></li>
            
            
            
            
            
            
            <li><a href="photon-overview.html">Photon Overview</a></li>
            
            
            
            
            
            
            <li><a href="docker-plugin-drivers.html">Docker Plugin Drivers</a></li>
            
            
            
            
            
            
            <li class="active"><a href="docker-volume-cli.html">Docker Volume CLI</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main"></h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" href="https://github.com/tomjohnson1492/documentation-theme-jekyll/blob/gh-pages/pages//docker-volume-cli.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

  <p>﻿# Using the Service in Docker</p>

<p>The Docker volume commands are supported for both the vSphere and Photon platforms with minor differences in capabilities. Features that are specific to either of the platforms are mentioned explicitly below.
<script type="text/javascript" src="https://asciinema.org/a/80417.js" id="asciicast-80417" async=""></script></p>

<h2 id="docker-volume-create-options">Docker volume create options</h2>
<p>### size</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=&lt;vsphere/photon&gt; --name=MyVolume -o size=10gb
</code></pre>
</div>

<p>The volume units can be <code class="highlighter-rouge">mb, gb and tb</code></p>

<p>The default volume size is 100mb</p>

<h3 id="vsan-policy-name-vsphere-only">vsan-policy-name (vSphere only)</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o vsan-policy-name=allflash
</code></pre>
</div>

<p>Policy needs to be created via the vmdkops-admin-cli. Once policy is created, it can be addressed during create by passing the <code class="highlighter-rouge">-o vsan-policy-name</code> flag.</p>

<h3 id="diskformat-vsphere-only">diskformat (vSphere only)</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o diskformat=zeroedthick
docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o diskformat=thin
docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o diskformat=eagerzeroedthick
</code></pre>
</div>

<p>Docker volumes are backed by VMDKs. VMDKs support multiple <a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242">types</a></p>

<p>Currently the following are supported</p>

<ol>
  <li>Thick Provision Lazy Zeroed (<a href="(https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242)">zeroedthick</a>)</li>
  <li>Thin Provision (<a href="(https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242)">thin</a>)</li>
  <li>Thick Provision Eager Zeroed (<a href="(https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242)">eagerzeroedthick</a>)</li>
</ol>

<h3 id="attach-as-vsphere-only">attach-as (vSphere only)</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o attach-as=independent_persistent
docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o attach-as=persistent
</code></pre>
</div>
<p>Docker volumes are backed by VMDKs. VMDKs are attached to the VM in which Docker is requesting for a volume during Docker run. VMDKs can be attached in <a href="http://cormachogan.com/2013/04/16/what-are-dependent-independent-disks-persistent-and-non-persisent-modes/">different modes.</a></p>

<p>Currently the following are supported</p>

<ol>
  <li><a href="http://cormachogan.com/2013/04/16/what-are-dependent-independent-disks-persistent-and-non-persisent-modes/">persistent</a>: If the VMDK is attached as persistent it will be part of a VM snapshot. If a VM snapshot has been taken while the Docker volume is attached to a VM, the Docker volume then continues to be attached to the VM that was snapshotted.</li>
  <li><a href="http://cormachogan.com/2013/04/16/what-are-dependent-independent-disks-persistent-and-non-persisent-modes/">independent_persistent</a>: If the VMDK is attached as independent_persistent it will not be part of a VM snapshot. The Docker volume can be attached to any VM that can access the datastore independent of snapshots.</li>
</ol>

<h3 id="access-vsphere-only">access (vSphere only)</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=vsphere --name=MyVolume -o access=read-only -o diskformat=thin
docker volume create --driver=vsphere --name=MyVolume -o access=read-write -o diskformat=thin (default)
</code></pre>
</div>

<p>The access mode determines if the volume is modifiable by containers in a VM. The access mode allows to first create a volume with write access and initialize it with binary images, libraries (for exmple), and subsequently change the access to “read-only” (via the admin CLI). Thereby, creating content sharable by all containers in a VM.</p>

<h3 id="fstype">fstype</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=&lt;vsphere/photon&gt; --name=MyVolume -o size=10gb -o fstype=xfs
docker volume create --driver=&lt;vsphere/photon&gt; --name=MyVolume -o size=10gb -o fstype=ext4 (default)
</code></pre>
</div>

<p>Specifies which filesystem will be created on the new volume. vSphere Docker Volume Service will search for a existing /sbin/mkfs.<strong>fstype</strong> on the docker host to create the filesystem, and if not found it will return a list of filesystems for which it has found a corresponding mkfs. The specified filesystem must be supported by the running kernel and support labels (-L flag for mkfs). Defaults to ext4 if not specified.</p>

<h3 id="clone-from-vsphere-only">clone-from (vSphere only)</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=vsphere --name=CloneVolume -o clone-from=MyVolume -o access=read-only
docker volume create --driver=vsphere --name=CloneVolume -o clone-from=MyVolume -o diskformat=thin (default)
</code></pre>
</div>

<p>Specifies a volume to be cloned when creating a new volume. The created clone is completely independent from the original volume and will inherit the same options, which can be changed with the exception of the size and fstype.</p>

<h3 id="flavor-photon-only">flavor (Photon only)</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume create --driver=vsphere --name=CloneVolume -o flavor=&lt;Photon persistent disk flavor name&gt;
</code></pre>
</div>

<p>The flavor specifies the name of the persistent disk flavor that must have already been created in the Photon Controller. The flavor indicats the resource limits that are applied to the volume being created.</p>

<h2 id="docker-volume-list">Docker volume list</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>docker volume ls
DRIVER              VOLUME NAME
vsphere                MyVolume@vsanDatastore
vsphere                minio1@vsanDatastore
vsphere                minio2@vsanDatastore
vsphere                redis-data@vsanDatastore
</code></pre>
</div>
<p>## Docker volume inspect
You can use <code class="highlighter-rouge">docker volume inspect</code> command to see vSphere attributes of a particular volume.
<code class="highlighter-rouge">
docker volume create —driver=vmdk —name=MyVolume -o size=2gb -o vsan-policy-name=myPolicy -o fstype=xfs
</code>
<code class="highlighter-rouge">
docker volume inspect MyVolume
[
    {
        "Driver": "vmdk",
        "Labels": {},
        "Mountpoint": "/mnt/vmdk/MyVolume",
        "Name": "MyVolume",
        "Options": {
            "fstype": "xfs",
            "size": "2gb",
            "vsan-policy-name": "myPolicy"
        },
        "Scope": "global",
        "Status": {
            "access": "read-write",
            "attach-as": "independent_persistent",
            "capacity": {
                "allocated": "32MB",
                "size": "2GB"
            },
            "clone-from": "None",
            "created": "Wed Mar  1 20:06:02 2017",
            "created by VM": "esx1_swarm01",
            "datastore": "vsanDatastore",
            "diskformat": "thin",
            "fstype": "xfs",
            "status": "detached",
            "vsan-policy-name": "myPolicy"
        }
    }
]
</code>
Note: For disk formats zeroedthick and zeroedthick, the allocated size would be total size plus the size of replicas.</p>

<h2 id="docker-compose">Docker Compose</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>cat nginx-stack-vsphere.yaml 
version: "3"
services:
  nginx:
    image: nginx
    ports:
      - "5000:80"
    volumes:
      - log:/var/log/nginx
    deploy:
      replicas: 1 
      restart_policy:
        condition: on-failure

volumes:
   log:
      driver: vsphere
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>docker stack deploy -c  nginx-stack-vsphere.yaml nginx
</code></pre>
</div>


    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 VMWare. All rights reserved. <br />
 Site last generated: Mar 23, 2017 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>